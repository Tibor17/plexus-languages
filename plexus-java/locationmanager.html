<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\markdown/locationmanager.md at 2018-11-24
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20181124" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Plexus Languages :: Java &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="../../" id="bannerLeft"><img src="../../images/plexus-logo-trans.png"  alt="Plexus"/></a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="../../" title="Plexus">Plexus</a><span class="divider">/</span></li>
      <li class=""><a href="../index.html" title="Plexus Languages">Plexus Languages</a><span class="divider">/</span></li>
      <li class=""><a href="index.html" title="Plexus Languages :: Java">Plexus Languages :: Java</a><span class="divider">/</span></li>
    <li class="active "></li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2018-11-24</li>
          <li id="projectVersion" class="pull-right">Version: 1.0.1</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="usage.html" title="Usage"><span class="none"></span>Usage</a></li>
    <li><a href="apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a></li>
    <li><a href="xref/index.html" title="Source Xref"><span class="none"></span>Source Xref</a></li>
      <li class="nav-header">Parent Project</li>
    <li><a href="../index.html" title="Plexus Languages"><span class="none"></span>Plexus Languages</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
      <li class="nav-header">Plexus Projects</li>
    <li><a href="../../modello/" title="Modello"><span class="none"></span>Modello</a></li>
    <li><a href="../../plexus-classworlds/" title="Plexus Classworlds"><span class="none"></span>Plexus Classworlds</a></li>
    <li><a href="" title="Plexus Components"><span class="icon-chevron-down"></span>Plexus Components</a>
    <ul class="nav nav-list">
    <li><a href="../../plexus-archiver/" title="Plexus Archiver"><span class="none"></span>Plexus Archiver</a></li>
    <li><a href="../../plexus-cli/" title="Plexus CLI"><span class="none"></span>Plexus CLI</a></li>
    <li><a href="../../plexus-compiler/" title="Plexus Compiler"><span class="none"></span>Plexus Compiler</a></li>
    <li><a href="../../plexus-digest/" title="Plexus Digest"><span class="none"></span>Plexus Digest</a></li>
    <li><a href="../../plexus-i18n/" title="Plexus i18n"><span class="none"></span>Plexus i18n</a></li>
    <li><a href="../../plexus-interactivity/" title="Plexus Interactivity"><span class="none"></span>Plexus Interactivity</a></li>
    <li><a href="../../plexus-interpolation/" title="Plexus Interpolation"><span class="none"></span>Plexus Interpolation</a></li>
    <li><a href="../../plexus-io/" title="Plexus IO"><span class="none"></span>Plexus IO</a></li>
    <li><a href="../../plexus-resources/" title="Plexus Resources"><span class="none"></span>Plexus Resources</a></li>
    <li><a href="../../plexus-swizzle/" title="Plexus Swizzle"><span class="none"></span>Plexus Swizzle</a></li>
    <li><a href="../../plexus-velocity/" title="Plexus Velocity"><span class="none"></span>Plexus Velocity</a></li>
    </ul>
</li>
    <li><a href="" title="Plexus Parent POMs"><span class="icon-chevron-down"></span>Plexus Parent POMs</a>
    <ul class="nav nav-list">
    <li><a href="../../plexus-pom/" title="Plexus"><span class="none"></span>Plexus</a></li>
    <li><a href="../../plexus-components/" title="Plexus Components"><span class="none"></span>Plexus Components</a></li>
    </ul>
</li>
    <li><a href="../../plexus-utils/" title="Plexus Utils"><span class="none"></span>Plexus Utils</a></li>
</ul>
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="http://codehaus-plexus.github.io/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript">asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
          <hr />
          <div id="poweredBy">
    <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
    <div class="g-plusone" data-href="http://codehaus-plexus.github.io/plexus-languages/plexus-java/" data-size="tall" ></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<p>The plexus-java library is created to have a solution for common activities, so this business logic doesn&#x2019;t have to be maintained at multiple places. The first provided feature was the <tt>LocationManager</tt> to analyze module desciptors and to decide which jars should end up on the modulepath and which on the classpath. The name was based on the [javax.tools.JavaFileManager.Location]. (<a class="externalLink" href="https://docs.oracle.com/javase/10/docs/api/javax/tools/JavaFileManager.Location.html">https://docs.oracle.com/javase/10/docs/api/javax/tools/JavaFileManager.Location.html</a>)</p>
<p>The library requires Java 7 to run, but contains optimized code for Java 9. By requiring Java 7 it was much easier to embed this library in several other projects.</p>
<p>This jar is a multi release jar (aka MRJAR), because it contains 2 implementations for the <tt>BinaryModuleInfoParser</tt>. If the Java runtime is 9 or above, the <tt>java.lang.module.ModuleDescriptor</tt> is used to read the <tt>module-info.class</tt>. If the runtime is Java 7 or Java 8, then ASM is used to read the module descriptor.</p>
<p>When extracting the the automatic module name based the of the file, it is a little bit more complex. The result must be precise, so the only way to solve this is by calling Java 9 code, either from the runtime or by calling Java 9 explicitly when provided via <tt>ResolvePathsRequest.setJdkHome</tt>.</p>
<div class="section">
<h2><a name="Request"></a>Request</h2>
<p>The <tt>LocationManager.resolvePaths()</tt> only has one argument, <tt>ResolvePathsRequest</tt>. If there is more data required, the request will be extended so the method signature of <tt>resolvePaths</tt> will stay the same.</p>
<p>There are 3 ways to create a <tt>ResolvePathsRequest</tt>:</p>
<ul>

<li>

<p><tt>ResolvePathsRequest.ofFiles(Collection&lt;File&gt;)</tt></p>
</li>
<li>

<p><tt>ResolvePathsRequest.ofPaths(Collection&lt;Path&gt;)</tt></p>
</li>
<li>

<p><tt>ResolvePathsRequest.ofStrings(Collection&lt;String&gt;)</tt></p>
</li>
</ul>
<p>As argument you pass all the archives and/or outputDirectories specified to build the project.</p>
<p>Additional methods are:</p>
<ul>

<li>

<p><tt>setAdditionalModules</tt>, in case the consumer wants to use <tt>--add-modules</tt></p>
</li>
<li>

<p><tt>setIncludeAllProviders</tt>, in general would only be used at runtime, not during compile or test. In case <tt>uses</tt> is used, all modules with matching <tt>provides</tt> are added as well.</p>
</li>
<li>

<p><tt>setJdkHome</tt>, should point to Java 9 or above in case the runtime of this library is Java 7 or 8</p>
</li>
<li>

<p><tt>setMainModuleDescriptor</tt>, which can either be a <tt>module-info.java</tt> or <tt>module-info.class</tt></p>
</li>
</ul></div>
<div class="section">
<h2><a name="Phase_1:_Collect"></a>Phase 1: Collect</h2>
<p>If there&#x2019;s a <tt>mainModuleDescriptor</tt>, extract a <tt>JavaModuleDescriptor</tt> of it. This might cause a <tt>IOException</tt> to be thrown.</p>
<p>All pathElements of <tt>ResolvePathsRequest.ofT</tt> are transformed to Path instances. For every element the name will be resolved in the following order:</p>
<ol style="list-style-type: decimal">

<li>

<p>Module descriptor: verify if the jar or the directory contains <tt>module-info.class</tt>. If so, the its descriptor is transformed to a <tt>JavaModuleDescriptor</tt>, where its ModuleNameSource is marked as <tt>ModuleNameSource.MODULEDESCRIPTOR</tt></p>
</li>
<li>

<p>Manifest: verify if the jar or directory has a <tt>META-INF/MANIFEST.MF</tt> and if it contains the <tt>Automatic-Module-Name</tt> attribute. If so, an automatic <tt>JavaModuleDescriptor</tt> is created, where its ModuleNameSource is marked as <tt>ModuleNameSource.MANIFEST</tt>.</p>
</li>
<li>

<p>Filename: try to extract the module name based on the filename. If the filename could be transformed to a module name (which is not always the case), an automatic <tt>JavaModuleDescriptor</tt> is created, where its ModuleNameSource is marked as <tt>ModuleNameSource.FILENAME</tt>.</p>
</li>
</ol>
<p>When there&#x2019;s an <tt>IOException</tt> with one of the pathElements, the exception is stored in the <tt>ResolvePathsResult.pathExceptions</tt> so the consumer can handle them separately.</p>
<p>The result are a couple of Maps:</p>
<ul>

<li>

<p>module name to <tt>ModuleNameSource</tt></p>
</li>
<li>

<p>module name to <tt>JavaModuleDescriptor</tt></p>
</li>
</ul></div>
<div class="section">
<h2><a name="Phase_2:_Resolve"></a>Phase 2: Resolve</h2>
<p>If there&#x2019;s a <tt>mainModuleDescriptor</tt>, collect all its direct and indirect requirements. This contains recursive code and ensures that required modules are only evaluated once. All these pathElements must be placed on the modulepath, all other pathElements will be marked for the classPath.</p></div>
<div class="section">
<h2><a name="Result"></a>Result</h2>
<p>All results will be stored in a <tt>ResolvePathsResult</tt>.</p>
<ul>

<li>

<p><tt>getClasspathElements()</tt>, ordered collection of all pathElements that don&#x2019;t belong to the modulepath</p>
</li>
<li>

<p><tt>getMainModuleDescriptor()</tt>, an <tt>JavaModuleDescriptor</tt> instance based on the provided mainModuleDescriptor file</p>
</li>
<li>

<p><tt>getModulepathElements()</tt>, ordered map of the pathElements with their source</p>
</li>
<li>

<p><tt>getPathElements()</tt>, ordered map of the pathElements with their module descriptor</p>
</li>
<li>

<p><tt>getPathExceptions()</tt>, map of pathElements containing only the elements that faced an exception.</p>
</li>
</ul></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2001&#x2013;2018
<a href="http://codehaus-plexus.github.io/">Codehaus Plexus</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>